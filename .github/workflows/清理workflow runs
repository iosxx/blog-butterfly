name:æ¸…ç†workflow runs

on:
  schedule:
    # æ¯å¤©åŒ—äº¬æ—¶é—´æ—©ä¸Š8ç‚¹è‡ªåŠ¨æ‰§è¡Œ30å¤©æ¸…ç†
    - cron: '0 0 * * *'  # UTCæ—¶é—´00:00 (åŒ—äº¬æ—¶é—´08:00)
  
  workflow_dispatch:
    inputs:
      cleanup_mode:
        description: "æ¸…ç†æ¨¡å¼ (normal/all)"
        type: choice
        required: true
        default: "normal"
        options:
          - normal
          - all

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      # æ¨¡å¼é€‰æ‹©é€»è¾‘
      - name: Determine cleanup mode
        id: mode
        run: |
          if [ "${{ inputs.cleanup_mode || 'normal' }}" == "all" ]; then
            echo "mode=aggressive" >> $GITHUB_OUTPUT
            echo "::warning::ğŸš¨ å…¨é‡æ¸…ç†æ¨¡å¼æ¿€æ´»! å°†åˆ é™¤æ‰€æœ‰å¯æ¸…ç†çš„å·¥ä½œæµå†å²"
          else
            echo "mode=normal" >> $GITHUB_OUTPUT
            echo "::notice::â„¹ï¸ æ‰§è¡Œæ ‡å‡†æ¸…ç† (ä¿ç•™30å¤©è®°å½•)"
          fi
      
      # æ ‡å‡†æ¸…ç†æ¨¡å¼ (é»˜è®¤)
      - name: Normal cleanup (30 days)
        if: steps.mode.outputs.mode == 'normal'
        uses: Mattraks/delete-workflow-runs@main
        with:
          retain_days: 30
          keep_minimum_runs: 20
          exclude_workflows: "Workflow Run Cleaner"
          exclude_status: "in_progress,queued"
          debug: true
      
      # å…¨é‡æ¸…ç†æ¨¡å¼ (æ‰‹åŠ¨è§¦å‘)
      - name: Full cleanup (DELETE ALL)
        if: steps.mode.outputs.mode == 'aggressive'
        uses: Mattraks/delete-workflow-runs@main
        with:
          retain_days: 0
          keep_minimum_runs: 0
          exclude_status: "in_progress,queued"
          exclude_workflows: "Workflow Run Cleaner"
          debug: true
      
      # å®Œæˆé€šçŸ¥
      - name: Completion notice
        run: |
          if [ "${{ steps.mode.outputs.mode }}" == "aggressive" ]; then
            echo "::warning::âœ… å…¨é‡æ¸…ç†å®Œæˆ! å·²åˆ é™¤æ‰€æœ‰å¯æ¸…ç†çš„å·¥ä½œæµå†å²"
          else
            echo "::notice::âœ… æ ‡å‡†æ¸…ç†å®Œæˆ! ä¿ç•™30å¤©å†…çš„è¿è¡Œè®°å½•"
          fi
