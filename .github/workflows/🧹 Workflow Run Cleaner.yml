name: ğŸ§¹ å…¨é‡æ¸…ç†æ‰€æœ‰å·¥ä½œæµå†å²

# è§¦å‘æ–¹å¼ï¼šä»…æ‰‹åŠ¨è§¦å‘ï¼ˆé¿å…è¯¯æ“ä½œï¼‰
on:
  workflow_dispatch:
    inputs:
      confirm_full_cleanup:
        description: 'è¯·è¾“å…¥ "confirm" ç¡®è®¤æ‰§è¡Œå…¨é‡æ¸…ç†ï¼ˆå°†åˆ é™¤æ‰€æœ‰éè¿›è¡Œä¸­çš„å·¥ä½œæµå†å²ï¼‰'
        type: string
        required: true

jobs:
  full-cleanup:
    runs-on: ubuntu-latest
    permissions:
      actions: write  # å¿…é¡»å…·å¤‡åˆ é™¤æƒé™
    if: ${{ github.event.inputs.confirm_full_cleanup == 'confirm' }}  # éªŒè¯ç¡®è®¤ä¿¡æ¯
    steps:
      - name: è­¦å‘Šæç¤º
        run: |
          echo "::warning::âš ï¸ æ­£åœ¨æ‰§è¡Œå…¨é‡æ¸…ç†ï¼å°†åˆ é™¤æ‰€æœ‰éè¿›è¡Œä¸­çš„å·¥ä½œæµå†å²è®°å½•"
          echo "::warning::âš ï¸ æ­¤æ“ä½œä¸å¯é€†ï¼Œè¯·ç¡®ä¿å·²å¤‡ä»½å¿…è¦æ•°æ®"

      - name: æ‰§è¡Œå…¨é‡æ¸…ç†
        uses: Mattraks/delete-workflow-runs@main
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          retain_days: 0  # ä¿ç•™å¤©æ•°è®¾ä¸º0ï¼ˆåˆ é™¤æ‰€æœ‰æ—§äº0å¤©çš„è®°å½•ï¼Œå³æ‰€æœ‰å¯åˆ è®°å½•ï¼‰
          keep_minimum_runs: 0  # ä¸ä¿ç•™æœ€å°è¿è¡Œæ¬¡æ•°ï¼ˆå¦‚éœ€ä¿ç•™å°‘é‡è®°å½•ï¼Œå¯æ”¹ä¸º1-5ï¼‰
          delete_workflow_by_state_pattern: 'completed'  # ä»…åˆ é™¤å·²å®Œæˆçš„å·¥ä½œæµï¼ˆè·³è¿‡è¿›è¡Œä¸­ï¼‰
          # å¯é€‰ï¼šæŒ‡å®šåˆ é™¤ç‰¹å®šå·¥ä½œæµï¼ˆå¦‚ä¸é™åˆ¶åˆ™æ³¨é‡Šæ­¤è¡Œï¼‰
          # delete_workflow_pattern: '*'  # åŒ¹é…æ‰€æœ‰å·¥ä½œæµ
          dry_run: false  # è®¾ä¸ºtrueå¯å…ˆé¢„è§ˆåˆ é™¤èŒƒå›´ï¼Œç¡®è®¤åæ”¹ä¸ºfalseæ‰§è¡Œå®é™…åˆ é™¤
